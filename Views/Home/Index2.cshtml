@{
    Layout = "_Layout2";
    ViewData["Title"] = "Home Page - CSP";

}

<div class="row">
    <div class="col-lg-12" style="margin-top: -50px;">
        <h1 class="page-header">
            Dashboard <small>Main Features</small>
        </h1>
    </div>
</div>
<div class="row">
    <div class="row col-lg-12 ">
        <div class="col-lg-3 col-md-12 ">
            <div class="panel panel-green">
                <div class="panel-heading">
                    <div class="row">
                        <div class="col-xs-3">
                            <i class="fa fa-handshake-o fa-5x"></i>
                        </div>
                        <div class="col-xs-9 text-right">
                            <p class="huge">Join Federation</p>
                        </div>
                    </div>
                </div>
                <a asp-area="" asp-controller="CloudMembers" asp-action="Create">
                    <div class="panel-footer">
                        <span class="pull-left">Join</span>
                        <span class="pull-right"><i class="fa fa-arrow-circle-right"></i></span>
                        <div class="clearfix"></div>
                    </div>
                </a>
            </div>
        </div>
        <div class="col-lg-3 col-md-12">
            <div class="panel panel-red">
                <div class="panel-heading">
                    <div class="row">
                        <div class="col-xs-3">
                            <i class="fa fa-sign-out fa-5x"></i>
                        </div>
                        <div class="col-xs-9 text-right">
                            <p class="huge">Leave Federation</p>
                        </div>
                    </div>
                </div>
                <a asp-area="" asp-controller="CloudMembers" asp-action="Index">
                    <div class="panel-footer">
                        <span class="pull-left">Leave</span>
                        <span class="pull-right"><i class="fa fa-arrow-circle-right"></i></span>
                        <div class="clearfix"></div>
                    </div>
                </a>
            </div>
        </div>
        <div class="col-lg-3 col-md-12">
            <div class="panel panel-primary">
                <div class="panel-heading">
                    <div class="row">
                        <div class="col-xs-3">
                            <i class="fa fa-microchip fa-5x"></i>
                        </div>
                        <div class="col-xs-9 text-right">
                            <p class="huge">Pubish Service</p>
                        </div>
                    </div>
                </div>
                <a asp-area="" asp-controller="Home" asp-action="PublishService">
                    <div class="panel-footer">
                        <span class="pull-left">Manage</span>
                        <span class="pull-right"><i class="fa fa-arrow-circle-right"></i></span>
                        <div class="clearfix"></div>
                    </div>
                </a>
            </div>
        </div>

        @*<div class="col-lg-6 col-md-12">
                <div class="panel panel-yellow">
                    <div class="panel-heading">
                        <div class="row">
                            <div class="col-xs-3">
                                <i class="fa fa-dollar fa-5x"></i>
                            </div>
                            <div class="col-xs-9 text-right">
                                <p class="huge">Manage Plans</p>
                            </div>
                        </div>
                    </div>
                    <a asp-area="" asp-controller="PlanTemplates" asp-action="Index">
                        <div class="panel-footer">
                            <span class="pull-left">Manage</span>
                            <span class="pull-right"><i class="fa fa-arrow-circle-right"></i></span>
                            <div class="clearfix"></div>
                        </div>
                    </a>
                </div>
            </div>
            <div class="col-lg-6 col-md-12">
                <div class="panel panel-danger">
                    <div class="panel-heading">
                        <div class="row">
                            <div class="col-xs-3">
                                <i class="fa fa-anchor fa-5x"></i>
                            </div>
                            <div class="col-xs-9 text-right">
                                <p class="huge">Manage Total Resources</p>
                            </div>
                        </div>
                    </div>
                    <a asp-area="" asp-controller="SummaryTotals" asp-action="Index">
                        <div class="panel-footer">
                            <span class="pull-left">Manage</span>
                            <span class="pull-right"><i class="fa fa-arrow-circle-right"></i></span>
                            <div class="clearfix"></div>
                        </div>
                    </a>
                </div>
            </div>*@

        @*<div class="col-lg-6 col-md-12">
                <div class="panel panel-success">
                    <div class="panel-heading">
                        <div class="row">
                            <div class="col-xs-3">
                                <i class="fa fa-envira fa-5x"></i>
                            </div>
                            <div class="col-xs-9 text-right">
                                <p class="huge">Create SLA Policy</p>
                            </div>
                        </div>
                    </div>
                    <a asp-area="" asp-controller="CloudMemberSLAPoliciesViewModels" asp-action="Create">
                        <div class="panel-footer">
                            <span class="pull-left">Manage</span>
                            <span class="pull-right"><i class="fa fa-arrow-circle-right"></i></span>
                            <div class="clearfix"></div>
                        </div>
                    </a>
                </div>
            </div>
            <div class="col-lg-6 col-md-12">
                <div class="panel panel-info">
                    <div class="panel-heading">
                        <div class="row">
                            <div class="col-xs-3">
                                <i class="fa fa-lock fa-5x"></i>
                            </div>
                            <div class="col-xs-9 text-right">
                                <p class="huge">Manage SLA Policies</p>
                            </div>
                        </div>
                    </div>
                    <a asp-area="" asp-controller="CloudMemberSLAPoliciesViewModels" asp-action="Index">
                        <div class="panel-footer">
                            <span class="pull-left">Manage</span>
                            <span class="pull-right"><i class="fa fa-arrow-circle-right"></i></span>
                            <div class="clearfix"></div>
                        </div>
                    </a>
                </div>
            </div>*@
    </div>
    <div class="row col-lg-12">
        <div class="col-lg-8">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h3 class="panel-title"><i class="fa fa-bar-chart-o fa-fw"></i> Published Services Response Time</h3>
                </div>
                <div class="panel-body">
                    <div id="morris-line-chart"></div>
                </div>
            </div>
        </div>
        <!--
        <div class="col-lg-4">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h3 class="panel-title"><i class="fa fa-bar-chart-o fa-fw"></i> Published Services Response Time</h3>
                </div>
                <div class="panel-body">
                    <div id="morris-bar-chart"></div>
                </div>
            </div>
        </div>
        -->
    </div>
</div>

@section Scripts{
    <script src="~/lib/morris.js/morris.min.js"></script>
    <script src="~/lib/raphael/raphael.min.js"></script>
    <script>
        /**
        Morris.Bar({
            element: 'morris-bar-chart',
            data: [{
                value: "SRV1/Web",
                value2: 0.75
            }, {
                value: "SRV1/DB",
                value2: 0.80
            }],
            ykeys: ['value2'],
            xkey: 'value',
            formatter: function (y, data) {
                return y + "s";
            },
            labels: ['ResponseTime'],
            resize: true
        });
        */
        GetResponseTime("1bf6314f-c46a-4ce5-b187-5e35cd68c3bc", "P30D", "1d").then((result) => {
            console.log(result);
            Morris.Line({
                // ID of the element in which to draw the chart.
                element: 'morris-line-chart',
                // Chart data records -- each entry in this array corresponds to a point on
                // the chart.
                data: result,
                // The name of the data record attribute that contains x-visitss.
                xkey: 'timestamp',
                // A list of names of data record attributes that contain y-visitss.
                ykeys: ['responseTime'],
                // Labels for the ykeys -- will be displayed when you hover over the
                // chart.
                labels: ['Sunfish.DataCollection'],
                // Disables line smoothing
                smooth: true,
                resize: true,
                xLabelFormat: function (x) {
                    var monthNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun",
                        "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"
                    ];

                    return x.getDate().toString() + " " + monthNames[x.getMonth()] + " " + x.getFullYear();
                },
                yLabelFormat: function (y) {
                    return y.toString() + "ms";
                }
            });
        }).catch((err) => {
            alert("Error loading Response time chart")
            console.log(err);
        });
        // Line Chart
        
        function GetResponseTime(applicationId, timeSpan, timeInterval) {
            return new Promise((resolve, reject) => {
                $.ajax({
                    type: 'POST',
                    data: {
                        applicationId: applicationId,
                        timeSpan: timeSpan,
                        timeInterval: timeInterval
                    },
                    url: "@Url.Action("GetResponseTime", "Reporting")",
                    success: function (data) {
                        console.log(data);
                        let result = [];
                        for (key in data) {
                            if (data.hasOwnProperty(key)) {
                                result.push({
                                    timestamp: key,
                                    responseTime: data[key]
                                });

                            }
                        }
                        resolve(result);
                    },
                    error: function (err) {
                        reject(err);
                    }
                });
            });
        }
    </script>
}